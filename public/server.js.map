{"version":3,"file":"server.js","mappings":"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","sources":["webpack://spyspy/./client/reducers.js","webpack://spyspy/./server/controllers/gameController.js","webpack://spyspy/./server/controllers/lobbyController.js","webpack://spyspy/./server/controllers/mainController.js","webpack://spyspy/./server/models/game.js","webpack://spyspy/./server/models/room.js","webpack://spyspy/./server/models/round.js","webpack://spyspy/./server/socket.js","webpack://spyspy/external commonjs \"@reduxjs/toolkit\"","webpack://spyspy/external commonjs \"express\"","webpack://spyspy/external commonjs \"randomstring\"","webpack://spyspy/external commonjs \"socket.io\"","webpack://spyspy/external commonjs \"socket.io-client\"","webpack://spyspy/external node-commonjs \"http\"","webpack://spyspy/external node-commonjs \"path\"","webpack://spyspy/webpack/bootstrap","webpack://spyspy/webpack/runtime/compat get default export","webpack://spyspy/webpack/runtime/define property getters","webpack://spyspy/webpack/runtime/hasOwnProperty shorthand","webpack://spyspy/webpack/runtime/make namespace object","webpack://spyspy/./server/server.js"],"sourcesContent":["import { configureStore, createSlice, combineReducers, PayloadAction} from \"@reduxjs/toolkit\";\r\n\r\nconst initialGameState = {\r\n    players: [],\r\n    spies: [],\r\n    knights: [],\r\n    rounds: [],\r\n    leader: '',\r\n    showRoles: false,\r\n    allAcknowledged: false,\r\n    selectedPlayers: [],\r\n    currentRound: 0,\r\n    castToVote: false,\r\n    allowToVote: true,\r\n    showWinner: false,\r\n    knightsWon: false,\r\n}\r\n\r\nconst initialRoomState = {\r\n    selfId: '',\r\n    selfAlias: '',\r\n    players: [],\r\n    roomCode: null,\r\n    error: null,\r\n    gameStarted:false,\r\n}\r\n\r\nconst roomsSlice = createSlice({\r\n    name: \"room\",\r\n    initialState:initialRoomState,\r\n    reducers: {\r\n        ioCreateRoom(state,action){\r\n        },\r\n        roomCreated(state,{action,payload}){\r\n            return {...state,...payload}; \r\n        },\r\n        ioEnterRoomCode(state,{action,payload}){            \r\n        },\r\n        updatePlayers(state,{action,payload}){\r\n            return {...state, players: payload}\r\n        },\r\n        updateSelf(state,{action,payload}){\r\n            return {\r\n                ...state,\r\n                ...payload\r\n            }\r\n        },\r\n        errorOccured(state,{action,payload}){\r\n            return {\r\n                ...state,\r\n                error: payload\r\n            }\r\n        },\r\n        ioPlayerIsReady(state,{action,payload}){\r\n        },\r\n        ioStartGame(state){\r\n\r\n        },\r\n        navigateToGame(state){\r\n            return {\r\n                ...state,\r\n                gameStarted: true\r\n            }\r\n        },\r\n        returnAllRoomData(state,{action,payload}){\r\n            return {...state,...payload}\r\n        },\r\n    }\r\n});\r\n\r\nconst gameSlice = createSlice({\r\n    name:\"game\",\r\n    initialState:initialGameState,\r\n    reducers: {\r\n        updateGameState(state,{action,payload}){\r\n            return{\r\n                ...state,\r\n                ...payload\r\n            }\r\n        },\r\n        ioGetAllData(state){\r\n        },\r\n        ioPlayerAcknowledged(state){},\r\n        allPlayersAcknowledged(state,{action,payload}){\r\n            return {...state,allAcknowledged:true,showRoles:false}\r\n        },\r\n        ioUpdateSelectedPlayers(state,{action,payload}){\r\n        },\r\n        updateSelectedPlayers(state,{action,payload}){\r\n            return {...state,selectedPlayers:payload}\r\n        },\r\n        ioCastToVote(state,{action,payload}){},\r\n        updateCastToVote(state,{action,payload}){\r\n            return {...state,castToVote:payload}\r\n        },\r\n        ioPlayerCastVote(state,{action,payload}){},\r\n        updateAllowToVote(state,{action,payload}){\r\n            return {...state,allowToVote:payload}\r\n        },\r\n        showWinner(state,{action,payload}){\r\n            return {...state,showWinner:true,knightsWon:payload}\r\n        },\r\n        hideShowWinner(state,{action,payload}){\r\n            return {...state,showWinner:false}\r\n        },\r\n        resetGameState(state,{action,payload}){\r\n            return {\r\n                ...state,\r\n                leader:payload.newLeader,\r\n                selectedPlayers: [],\r\n                currentRound:payload.currentRound,\r\n                castToVote: false,\r\n                allowToVote: true,\r\n                showWinner: false,\r\n                knightsWon: false,\r\n                rounds: payload.rounds\r\n            }\r\n        },\r\n        ioVetoMissionHandler(state,{action,payload}){},\r\n    }\r\n}\r\n);\r\n\r\n//Root reducer for usage in the store\r\nexport const rootReducer = combineReducers({\r\n    room: roomsSlice.reducer,\r\n    game: gameSlice.reducer,\r\n});\r\n\r\n//Make action creators accesible \r\n\r\nexport const {\r\n    ioCreateRoom,\r\n    roomCreated,\r\n    navigateToLobby,\r\n    ioEnterRoomCode,\r\n    updatePlayers,\r\n    updateSelf,\r\n    errorOccured,\r\n    ioPlayerIsReady,\r\n    ioStartGame,\r\n    navigateToGame,\r\n    returnAllRoomData\r\n} = roomsSlice.actions;\r\n\r\nexport const {\r\n    updateGameState,\r\n    ioGetAllData,\r\n    ioPlayerAcknowledged,\r\n    allPlayersAcknowledged,\r\n    ioUpdateSelectedPlayers,\r\n    updateSelectedPlayers,\r\n    ioCastToVote,\r\n    updateCastToVote,\r\n    ioPlayerCastVote,\r\n    updateAllowToVote,\r\n    showWinner,\r\n    hideShowWinner,\r\n    resetGameState,\r\n    ioVetoMissionHandler\r\n} = gameSlice.actions;\r\n\r\n","import {Game} from '../models/game';\r\nimport Round from '../models/round';\r\n\r\nimport {\r\n    navigateToGame,\r\n} from '../../client/reducers';\r\nimport {\r\n    updateGameState,\r\n    allPlayersAcknowledged,\r\n    updateSelectedPlayers,\r\n    updateCastToVote,\r\n    updateAllowToVote,\r\n    showWinner,\r\n    hideShowWinner,\r\n    resetGameState\r\n} from '../../client/reducers';\r\nimport { io } from 'socket.io-client';\r\n\r\nexport default class GameController {\r\n    constructor(io){\r\n        this.io = io;\r\n        this.games = new Map();\r\n    }\r\n\r\n    createGame = function(room){\r\n        const game = new Game(room);\r\n        this.games.set(room.roomCode,game)\r\n        return game;\r\n    } \r\n\r\n    checkAllPlayersAcknowledged = function(roomCode){\r\n        let game = this.games.get(roomCode);\r\n        game.playersAcknowledgedRole++;\r\n        if(game.playersAcknowledgedRole === game.players.length){\r\n            this.io.in(roomCode).emit(allPlayersAcknowledged.type)\r\n        }\r\n        return game;\r\n    }\r\n\r\n    sendSelectedPlayersToRoom = function(roomCode, selectedPlayers){\r\n        this.io.in(roomCode).emit(updateSelectedPlayers.type,selectedPlayers);\r\n    }\r\n\r\n    updateCastToVote = function(roomCode, castToVote){\r\n        this.castToVote = castToVote;\r\n        this.io.in(roomCode).emit(updateCastToVote.type,castToVote);\r\n    }\r\n\r\n    getGameFromRoomcode = function(roomCode){\r\n        return this.games.get(roomCode);\r\n    }\r\n\r\n    setGameWithRoomcode = function(roomCode,game){\r\n        this.games.set(roomCode,game)\r\n    }\r\n\r\n    //updates a players choice whether to veto or pass the mission\r\n    updateVetoDecision = function(roomCode, playerId, veto){\r\n        console.log(`${playerId} : ${veto} updated`)\r\n        let game = this.getGameFromRoomcode(roomCode)\r\n        console.log(game)\r\n        if(veto==true){\r\n            game.rounds[game.currentRound].vetoed.push(playerId)\r\n        } if(veto==false) {\r\n            game.rounds[game.currentRound].accepted.push(playerId)\r\n        }\r\n        console.log(game.rounds[game.currentRound])\r\n    }\r\n\r\n    updatePlayerVote = function(gameToUpdate,selfId,missionPass){\r\n        let game = gameToUpdate;\r\n        missionPass ? game.rounds[game.currentRound].numberOfPass++ : game.rounds[game.currentRound].numberOfFail++;\r\n        let playerName = this.getNameFromId(game,selfId);\r\n        game.rounds[game.currentRound].playersOnMission.push(playerName);\r\n        return game;\r\n    }\r\n\r\n    checkAllPlayersVoted = function(roomCode){\r\n        const game = this.getGameFromRoomcode(roomCode)\r\n        const currentRound = game.rounds[game.currentRound]\r\n        if((currentRound.numberOfFail + currentRound.numberOfPass) === game.missionRules[game.players.length-5][game.currentRound]){\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    checkIfKnightsWin = function(roomCode){\r\n        let game = this.games.get(roomCode)\r\n        let currentRound = game.rounds[game.currentRound]\r\n        //if mission fails then spies won\r\n        if(currentRound.numberOfFail>=1 && game.players.length<7){\r\n            game.rounds[game.currentRound].knightsWon = false;\r\n            this.games.set(roomCode,game)\r\n            return false;\r\n        } else if (currentRound.numberOfFail>=2 && game.players.length >= 7 ){\r\n            game.rounds[game.currentRound].knightsWon = false;\r\n            this.games.set(roomCode,game)\r\n            return false;\r\n        } else {\r\n            game.rounds[game.currentRound].knightsWon = true;\r\n            this.games.set(roomCode,game)\r\n            return true;\r\n        }\r\n    }\r\n\r\n    transitionRound = function(roomCode){\r\n        let game = this.getGameFromRoomcode(roomCode);\r\n        let knightsWon = this.checkIfKnightsWin(roomCode);\r\n        this.storeWinner(knightsWon,this.getGameFromRoomcode(roomCode)) \r\n        this.incrementRound(game);\r\n        //send something back to the front-end to show the winner \r\n        this.io.in(roomCode).emit(showWinner.type,knightsWon);\r\n        setTimeout(()=>{\r\n            //wait 30 seconds and then\r\n            // hide the winners \r\n            this.io.in(roomCode).emit(hideShowWinner.type);\r\n            this.io.in(roomCode).emit(resetGameState.type,{rounds:game.rounds,currentRound:game.currentRound,newLeader:game.leader});\r\n        },10000)\r\n            \r\n            // increment the round and reset what needs to be reset\r\n    }\r\n\r\n    //need to add a new blank round\r\n    //set game.currentRound++\r\n    //game.selectedPlayers back to []\r\n    //game.leader = ''\r\n    //\r\n\r\n    storeWinner = function(knightsWin,game){\r\n        let updatedGame = game; \r\n        updatedGame.rounds[game.currentRound].knightsWon = knightsWin;\r\n        this.setGameWithRoomcode(updatedGame.roomCode, updatedGame);\r\n    }\r\n\r\n    incrementRound = function(game){\r\n        let updatedGame = game; \r\n        updatedGame.currentRound++;\r\n        updatedGame.leader = updatedGame.incrementMissionLeader(updatedGame.players,updatedGame.leader);\r\n        this.setGameWithRoomcode(updatedGame.roomCode,updatedGame);\r\n    }\r\n\r\n    //works under the assumption that player names will not be the same\r\n    getNameFromId = (game,providedSelfId) => {\r\n        let playerName = game.players.filter((player)=>{\r\n            return player.playerId===providedSelfId\r\n        })\r\n        if(playerName[0]){\r\n            return playerName[0].selfAlias;\r\n        } else {\r\n            return null;\r\n        }\r\n        \r\n    }\r\n\r\n    checkGameOver(rounds){\r\n        let timesKnightsWon = 0;\r\n        let timesSpiesWon = 0;\r\n        let gameOver = false;\r\n        let knightsWonGame = null;\r\n\r\n        rounds.forEach((round)=>{\r\n            if(round.knightsWon === true){\r\n                timesKnightsWon++;\r\n            } else if (round.knightsWon === false){\r\n                timesSpiesWon++;\r\n            }\r\n        })\r\n\r\n        if(timesKnightsWon===3){\r\n            gameOver = true;\r\n            knightsWonGame = true;\r\n            return [gameOver,knightsWonGame]\r\n        } else if (timesSpiesWon===3){\r\n            gameOver = true;\r\n            knightsWonGame = false;\r\n            return [gameOver,knightsWonGame]\r\n        } else {\r\n            return [false,null]\r\n        }\r\n    }\r\n}\r\n\r\nexport const communicateStartOfGame = (io, toRoom, game) => {\r\n    io.in(toRoom).emit(navigateToGame.type);\r\n    io.in(toRoom).emit(updateGameState.type,game);\r\n}\r\n\r\nexport const communicatePlayerCantVote = (io,selfId) => {\r\n    io.to(selfId).emit(updateAllowToVote.type,false)\r\n}\r\n\r\n\r\n","import {\r\n    roomCreated,\r\n    updatePlayers,\r\n    updateSelf,\r\n    errorOccured,\r\n    returnAllRoomData\r\n} from '../../client/reducers';\r\n\r\nimport { Room } from '../models/room';\r\n\r\n// one instance is made on server start up\r\nexport default class LobbyController{\r\n\r\n    constructor(io){\r\n        this.io=io;\r\n        this.rooms = new Map();\r\n        this.playersToRooms = new Map();\r\n    }\r\n\r\n    createRoom = function(playerId){\r\n        const newRoom = new Room(playerId);\r\n        this.addToRoomMap(newRoom);\r\n        this.addPlayerToRoomMap(newRoom,playerId);\r\n        this.io.to(playerId).emit(roomCreated.type,this.formattedRoom(newRoom,playerId));\r\n        return newRoom.roomCode\r\n    }\r\n\r\n    joinRoom = function(enteredRoomCode,socket){\r\n        if(this.checkRoomExists(enteredRoomCode)){\r\n            if(!this.roomIsFull(enteredRoomCode)){\r\n                socket.join(enteredRoomCode);\r\n                const room = this.rooms.get(enteredRoomCode)\r\n                this.addPlayerToRoomMap(room,socket.id)\r\n                const players = this.addPlayerToRoom(enteredRoomCode,socket.id)\r\n                //update this players state \r\n                this.io.to(socket.id).emit(updateSelf.type,this.formattedPlayer(enteredRoomCode,players,socket.id));\r\n                //update all players state with the list of players\r\n                this.io.in(enteredRoomCode).emit(updatePlayers.type,players);\r\n            } else {\r\n                this.io.to(socket.id).emit(errorOccured.type,'roomIsFull');\r\n            }\r\n        } else{\r\n            \r\n        }          \r\n    }\r\n\r\n    playerLeft = function(playerId){\r\n        try{\r\n            this.removePlayerFromRoom(playerId)\r\n        } catch(error){\r\n            console.log(chalk.red('an error occured trying to remove a player from their room'));\r\n            console.log(error);\r\n        }  \r\n    }\r\n\r\n    addToRoomMap = function(newRoom){\r\n        return this.rooms.set(newRoom.roomCode,newRoom);\r\n    }\r\n\r\n    addPlayerToRoomMap = function(newRoom,playerId){\r\n        return this.playersToRooms.set(playerId,newRoom.roomCode);\r\n    }\r\n\r\n    formattedRoom = function(newRoom,playerId){\r\n        return {\r\n            roomCode: newRoom.roomCode,\r\n            selfId: playerId,\r\n            selfAlias: newRoom.players[0].selfAlias,\r\n            players: newRoom.players\r\n        }\r\n    }\r\n\r\n    formattedPlayer = function(roomCode, playersArray,playerId){\r\n\r\n        const selfAlias = playersArray.filter((player)=>{\r\n            return player.selfId === playerId\r\n        }).selfAlias\r\n\r\n        return {\r\n            roomCode: roomCode, \r\n            selfId: playerId,\r\n            selfAlias\r\n        }\r\n    }\r\n\r\n    checkRoomExists(enteredCode){\r\n        return this.rooms.has(enteredCode)\r\n    }\r\n\r\n    addPlayerToRoom(enteredRoomCode, player){\r\n        let room = this.rooms.get(enteredRoomCode);\r\n        if(room){\r\n            if(room.players.length<10){\r\n                room.addPlayer(player);\r\n            }\r\n            return room.players;\r\n        } else {\r\n            console.log(chalk.red(`no room was found for ${enteredCode}`))\r\n        }\r\n    }\r\n\r\n    removePlayerFromRoom(playerId){\r\n        if(this.playersToRooms.size===0 || this.playersToRooms.get(playerId) === undefined){\r\n            return;\r\n        }\r\n        let roomName = this.playersToRooms.get(playerId);\r\n        let playerRoom = this.rooms.get(roomName);\r\n        if(playerRoom){\r\n            \r\n            let remainingPlayers = (playerRoom.players).filter((player)=>{\r\n                return player.playerId !== playerId\r\n            });\r\n    \r\n            playerRoom = {\r\n                ...playerRoom, \r\n                players:remainingPlayers\r\n            }\r\n    \r\n            if(playerRoom.players.length===0){\r\n                this.rooms.delete(roomName);    \r\n            } else {\r\n                this.rooms.set(roomName,playerRoom);\r\n                this.io.in(roomName).emit(updatePlayers.type,remainingPlayers);\r\n            } \r\n        }\r\n    }\r\n\r\n    roomIsFull = function(roomCode) {\r\n        let room = this.rooms.get(roomCode);\r\n        return room.players.length < 10 ? false : true; \r\n    }\r\n\r\n    //returns an updated player array where the callingPlayer's isReady property is flipped\r\n    updatePlayerReadiness = function(callingPlayerId){\r\n        const room = this.rooms.get(this.playersToRooms.get(callingPlayerId))\r\n        const updatedPlayerArray = (room.players||[]).map((player)=>{\r\n            if(player.playerId === callingPlayerId){\r\n                return {...player,readyToStart:!player.readyToStart}\r\n            } else {\r\n                return player;\r\n            }\r\n        })\r\n        return updatedPlayerArray\r\n    }\r\n\r\n    sendUpdatedPlayersToRoom = function(updatedPlayers,enteredRoomCode){\r\n        this.io.in(enteredRoomCode).emit(updatePlayers.type,updatedPlayers);\r\n    }\r\n\r\n    getRoom = function(enteredRoomCode){\r\n        return this.rooms.get(enteredRoomCode);\r\n    }\r\n\r\n    emitAllRoomData = function(enteredRoomCode, socketId){\r\n        //Problem here is that the socket id changes between refreshes\r\n        //Would have to implement a way to cache the player session\r\n    }\r\n\r\n}\r\n\r\n\r\n","import LobbyController from \"./lobbyController\";\r\nimport GameController, {communicateStartOfGame,communicatePlayerCantVote} from \"./gameController\";\r\n\r\nimport {\r\n    ioCreateRoom,\r\n    ioEnterRoomCode,\r\n    ioPlayerIsReady,\r\n    ioStartGame,\r\n    errorOccured,\r\n    ioPlayerAcknowledged,\r\n    ioUpdateSelectedPlayers,\r\n    ioGetAllData,\r\n    ioCastToVote,\r\n    ioPlayerCastVote,\r\n    ioVetoMissionHandler,\r\n} from '../../client/reducers';\r\n\r\n//Handles socket \r\nexport default class MainController {\r\n    constructor(io){\r\n        this.io = io;\r\n        this.lobbyController = new LobbyController(this.io);\r\n        this.gameController = new GameController(this.io);\r\n\r\n        this.io.on(\"connection\", (socket) => {\r\n\r\n            socket.on(ioCreateRoom.type,()=>{\r\n                socket.join(this.lobbyController.createRoom(socket.id));\r\n            });\r\n    \r\n            socket.on(ioEnterRoomCode.type,(enteredRoomCode)=>{\r\n                 this.lobbyController.joinRoom(enteredRoomCode,socket);\r\n            });\r\n\r\n            socket.on(\"disconnect\",()=>{\r\n               this.lobbyController.playerLeft(socket.id)\r\n            })\r\n\r\n            socket.on(ioPlayerIsReady.type,(payload)=>{\r\n                const updatedPlayers = this.lobbyController.updatePlayerReadiness(payload.playerId);\r\n                this.lobbyController.rooms.get(payload.roomCode).updatePlayers(updatedPlayers);\r\n                this.lobbyController.sendUpdatedPlayersToRoom(updatedPlayers,payload.roomCode);\r\n            });\r\n\r\n            socket.on(ioStartGame.type,(enteredRoomCode)=>{\r\n                const room = this.lobbyController.getRoom(enteredRoomCode)\r\n                if(room){\r\n                    let game = this.gameController.createGame(room);\r\n                    communicateStartOfGame(io,room.roomCode,game);\r\n                } else {\r\n                    console.log('Tried to create a gameController without valid room object passed. Passed to function:')\r\n                    console.log(room)\r\n                }\r\n            })\r\n\r\n            socket.on(ioGetAllData.type,(enteredRoomCode)=>{\r\n                if(this.lobbyController.checkRoomExists(enteredRoomCode)){\r\n                    this.lobbyController.emitAllRoomData(enteredRoomCode,socket.id)\r\n                } else {\r\n                    io.to(socket.id).emit(errorOccured.type,'No Such Room Exists...');\r\n                }\r\n            })\r\n\r\n            socket.on(ioPlayerAcknowledged.type,(enteredRoomCode)=>{\r\n                this.gameController.setGameWithRoomcode(this.gameController.checkAllPlayersAcknowledged(enteredRoomCode));\r\n            })\r\n\r\n            socket.on(ioUpdateSelectedPlayers.type,(payload)=>{\r\n                this.gameController.sendSelectedPlayersToRoom(payload.roomCode,payload.newSelectedPlayers)\r\n            })\r\n\r\n            socket.on(ioCastToVote.type,(payload)=>{\r\n                this.gameController.updateCastToVote(payload.roomCode,payload.castToVote)\r\n            })\r\n\r\n            socket.on(ioPlayerCastVote.type,(payload)=>{\r\n                this.gameController.setGameWithRoomcode(this.gameController.updatePlayerVote(this.gameController.getGameFromRoomcode(payload.roomCode),payload.selfId,payload.missionPass));\r\n                communicatePlayerCantVote(io,payload.selfId);\r\n                let allPlayersVoted = this.gameController.checkAllPlayersVoted(payload.roomCode);\r\n                if(allPlayersVoted){\r\n                    this.gameController.transitionRound(payload.roomCode);\r\n                    let [gameOver,knightsWonGame] = this.gameController.checkGameOver(this.gameController.getGameFromRoomcode(payload.roomCode).rounds);\r\n                    if(!gameOver){\r\n                    } else {\r\n                        console.log('Game over')\r\n                    }\r\n                }\r\n            })\r\n\r\n            socket.on(ioVetoMissionHandler.type,(payload)=>{\r\n                this.gameController.updateVetoDecision(payload.roomCode,payload.playerId,payload.vetoMission);\r\n            })\r\n        });\r\n    }\r\n}","import Round from '../models/round';\r\nimport { Room } from './room';\r\n\r\nexport class Game {\r\n    constructor(room){\r\n        this.roomCode = room.roomCode;\r\n        this.players = [...room.players];\r\n        this.numberOfPlayers = this.players.length;\r\n        let selectedRoles = this.selectRoles(this.players)\r\n        this.spies = selectedRoles.spies;\r\n        this.knights = selectedRoles.knights;\r\n        this.rounds = [\r\n            new Round(),\r\n            new Round(),\r\n            new Round(),\r\n            new Round(),\r\n            new Round(),\r\n        ];\r\n        this.leader = this.selectMissionLeader(this.players);\r\n        this.showRoles = true;\r\n        this.playersAcknowledgedRole = 0;\r\n        this.castToVote = false;\r\n        this.currentRound = 0;\r\n        this.missionRules = [\r\n            [2,3,2,3,3], //5 players\r\n            [2,3,4,3,4], //6 players\r\n            [2,3,3,4,4], //7 players\r\n            [3,4,4,5,5], //8 players\r\n            [3,4,4,5,5], //9 players\r\n            [3,4,4,5,5] //10 players\r\n        ]\r\n    }\r\n\r\n    //selects 1/3 (rounded up) of players to be spies \r\n    selectRoles = function(players){\r\n        let playersArray = [...players];\r\n        let spies = []\r\n        let knights = []\r\n        //assign the spies\r\n        while(spies.length<Math.ceil((players.length*0.33))){\r\n            let randomIndex = Math.ceil((Math.random()*playersArray.length))-1;\r\n            spies.push(playersArray[randomIndex])\r\n            playersArray.splice(randomIndex,1)\r\n        }\r\n        knights = playersArray; //assign the remaining knights\r\n\r\n        return {spies, knights};\r\n    }\r\n\r\n    selectMissionLeader = function(players){\r\n        let randomIndex = Math.ceil((Math.random()*players.length))-1;\r\n        return players[randomIndex].playerId;\r\n    }\r\n\r\n    // incrementMissionLeader = function(players,previousMissionLeader)\r\n    // if previous leader is number 4, should return 5\r\n    // if previous leader is 5 should return 1\r\n\r\n    incrementMissionLeader = function(players,previousMissionLeader){\r\n        let previousLeaderIndex = players.findIndex(player => player.playerId===previousMissionLeader);\r\n        let leaderIsLast = previousLeaderIndex === players.length-1;\r\n        if(leaderIsLast){\r\n            return players[0].playerId;\r\n        } else {\r\n            return players[previousLeaderIndex+1].playerId;\r\n        }\r\n    }\r\n}","import randomstring from \"randomstring\";\r\nimport { io } from \"socket.io-client\";\r\n\r\nexport class Room {\r\n\r\n    //callingPlayerId: socket.id\r\n    constructor(callingPlayerId){\r\n        this.roomCode = this.generateRoomCode();\r\n        this.players = [];\r\n        this.addPlayer(callingPlayerId)\r\n    }\r\n\r\n    generateRoomCode = function(){\r\n        return randomstring.generate({\r\n            length: 6,\r\n            charset: 'alphanumeric'\r\n        });\r\n    }\r\n\r\n    addPlayer = function(callingPlayerId){\r\n        this.players.push({\r\n            playerId:callingPlayerId,\r\n            selfAlias:`Player${this.players.length+1}`,\r\n            readyToStart: false\r\n        });\r\n    }\r\n\r\n    updatePlayers = function(newPlayerArray){\r\n        this.players = newPlayerArray;\r\n    }\r\n\r\n}","export default class Round {\r\n    constructor(){\r\n        this.playersOnMission= [];\r\n        this.numberOfPass = 0;\r\n        this.numberOfFail = 0;\r\n        this.knightsWon = undefined;\r\n        this.accepted = [];\r\n        this.vetoed = []; \r\n    }\r\n}","import { Server } from 'socket.io';\r\nimport path from 'path';\r\n\r\nexport default (httpServer) => {\r\n\r\n    console.log('Setting up socket.io server...');\r\n    const io = new Server(httpServer,{\r\n        cors: {\r\n            origin: \"*\"\r\n        },\r\n    });\r\n\r\n    return io;\r\n}","module.exports = require(\"@reduxjs/toolkit\");","module.exports = require(\"express\");","module.exports = require(\"randomstring\");","module.exports = require(\"socket.io\");","module.exports = require(\"socket.io-client\");","module.exports = require(\"http\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import express from 'express';\r\nimport socketServer from \"./socket\";\r\nimport {createServer} from 'http';\r\nimport path from 'path';\r\nconst publicPath = path.join(__dirname, '..', 'public','dist');\r\nimport MainController from './controllers/mainController';\r\n\r\nconst expressServer = express();\r\nexpressServer.use(express.static(publicPath));\r\nexpressServer.get('*', (req, res)=>{\r\n    res.sendFile(path.join(publicPath,'index.html'));\r\n})\r\n\r\nconst httpServer = createServer(expressServer);\r\n\r\nconst io = socketServer(httpServer);\r\n\r\nconst port = process.env.PORT || 3000\r\nhttpServer.listen(port, ()=> {\r\n    console.log(`Server running on port ${port}`);\r\n});\r\n\r\nconst mainController = new MainController(io);\r\n\r\n\r\n"],"names":["configureStore","createSlice","combineReducers","PayloadAction","initialGameState","players","spies","knights","rounds","leader","showRoles","allAcknowledged","selectedPlayers","currentRound","castToVote","allowToVote","showWinner","knightsWon","initialRoomState","selfId","selfAlias","roomCode","error","gameStarted","roomsSlice","name","initialState","reducers","ioCreateRoom","state","action","roomCreated","payload","ioEnterRoomCode","updatePlayers","updateSelf","errorOccured","ioPlayerIsReady","ioStartGame","navigateToGame","returnAllRoomData","gameSlice","updateGameState","ioGetAllData","ioPlayerAcknowledged","allPlayersAcknowledged","ioUpdateSelectedPlayers","updateSelectedPlayers","ioCastToVote","updateCastToVote","ioPlayerCastVote","updateAllowToVote","hideShowWinner","resetGameState","newLeader","ioVetoMissionHandler","rootReducer","room","reducer","game","actions","navigateToLobby","Game","Round","io","GameController","games","set","get","playersAcknowledgedRole","length","emit","type","playerId","veto","console","log","getGameFromRoomcode","vetoed","push","accepted","gameToUpdate","missionPass","numberOfPass","numberOfFail","playerName","getNameFromId","playersOnMission","missionRules","checkIfKnightsWin","storeWinner","incrementRound","setTimeout","knightsWin","updatedGame","setGameWithRoomcode","incrementMissionLeader","providedSelfId","filter","player","Map","timesKnightsWon","timesSpiesWon","gameOver","knightsWonGame","forEach","round","communicateStartOfGame","toRoom","communicatePlayerCantVote","to","Room","LobbyController","newRoom","addToRoomMap","addPlayerToRoomMap","formattedRoom","enteredRoomCode","socket","checkRoomExists","roomIsFull","join","rooms","id","addPlayerToRoom","formattedPlayer","removePlayerFromRoom","chalk","red","playersToRooms","playersArray","callingPlayerId","updatedPlayerArray","map","readyToStart","updatedPlayers","socketId","enteredCode","has","addPlayer","size","undefined","roomName","playerRoom","remainingPlayers","MainController","lobbyController","gameController","on","createRoom","joinRoom","playerLeft","updatePlayerReadiness","sendUpdatedPlayersToRoom","getRoom","createGame","emitAllRoomData","checkAllPlayersAcknowledged","sendSelectedPlayersToRoom","newSelectedPlayers","updatePlayerVote","allPlayersVoted","checkAllPlayersVoted","transitionRound","checkGameOver","updateVetoDecision","vetoMission","Math","ceil","randomIndex","random","splice","previousMissionLeader","previousLeaderIndex","findIndex","leaderIsLast","numberOfPlayers","selectedRoles","selectRoles","selectMissionLeader","randomstring","generate","charset","newPlayerArray","generateRoomCode","Server","path","httpServer","cors","origin","express","socketServer","createServer","publicPath","__dirname","expressServer","use","req","res","sendFile","port","process","env","PORT","listen","mainController"],"sourceRoot":""}